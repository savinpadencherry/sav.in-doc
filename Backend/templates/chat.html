{% extends "base.html" %}

{% block title %}Chat - SAV.IN{% endblock %}

{% block content %}
<div class="chat-layout">
    <!-- Enhanced Chat Sidebar -->
    <div class="chat-sidebar">
        <div class="sidebar-header">
            <h2>
                <i class="material-icons">chat_bubble</i>
                Your Chats
            </h2>
            <button class="create-chat-btn" id="createChatBtn">
                <i class="material-icons">add</i>
                New Chat
            </button>
        </div>
        <div class="chat-list" id="chatList">
            <div class="loading-placeholder">
                <div class="spinner"></div>
                <p>Loading chats...</p>
            </div>
        </div>
    </div>

    <!-- Main Chat Area -->
    <div class="chat-main">
        <div class="chat-header">
            <div class="chat-title-section">
                <h3 class="current-chat-title" id="currentChatTitle">Select or Create a Chat</h3>
                <div class="current-chat-meta" id="currentChatMeta">
                    <span>Choose a chat or create a new one to get started</span>
                </div>
                <div class="selected-documents" id="selectedDocuments"></div>
            </div>
        </div>
        <div class="messages-container" id="messagesContainer">
            <div class="chat-placeholder">
                <i class="material-icons">smart_toy</i>
                <h3>Welcome to SAV.IN!</h3>
                <p>Create a new chat or select an existing one to start conversing with your documents using our local Granite AI models.</p>
            </div>
        </div>
        <div class="chat-input-container">
            <div class="input-wrapper">
                <textarea
                    class="message-input"
                    id="messageInput"
                    placeholder="Create or select a chat first..."
                    rows="1"
                    disabled
                ></textarea>
                <button class="send-btn" id="sendBtn" disabled>
                    <i class="material-icons">send</i>
                </button>
            </div>
        </div>
    </div>

    <!-- Document Preview Panel -->
    <div class="pdf-viewer">
        <div class="viewer-header">
            <h3>
                <i class="material-icons">preview</i>
                Document Preview
            </h3>
            <div class="viewer-controls">
                <button class="control-btn" title="Zoom Out">
                    <i class="material-icons">zoom_out</i>
                </button>
                <button class="control-btn" title="Zoom In">
                    <i class="material-icons">zoom_in</i>
                </button>
                <button class="control-btn" title="Fullscreen">
                    <i class="material-icons">fullscreen</i>
                </button>
            </div>
        </div>
        <div class="pdf-content" id="pdfPreview">
            <div class="empty-state">
                <i class="material-icons">description</i>
                <h4>Document Preview</h4>
                <p>Select documents and start chatting to see AI-highlighted sources appear here</p>
                <small>The AI will automatically highlight relevant sections as you ask questions</small>
            </div>
        </div>
        <div class="document-selection-area" style="max-height: 300px; overflow-y: auto; padding: 16px; border-top: 2px solid var(--divider);">
            <h4 style="margin-bottom: 16px; color: var(--text-primary); font-size: 16px;">
                <i class="material-icons" style="vertical-align: middle; margin-right: 8px;">library_books</i>
                Select Documents
            </h4>
            <div class="document-list" id="documentList">
                <div class="loading-placeholder">
                    <div class="spinner"></div>
                    <p>Loading documents...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Chat Modal -->
<div class="modal-overlay" id="modalOverlay" style="display: none;">
    <div class="modal" id="chatModal">
        <div class="modal-header">
            <h3>Create New Chat Session</h3>
            <p>Give your chat a memorable name to organize your conversations</p>
        </div>
        <div class="modal-body">
            <input
                type="text"
                class="modal-input"
                id="chatNameInput"
                placeholder="Enter chat name (e.g., Research Discussion)..."
                maxlength="100"
            >
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="chatManager.hideModal()">
                <i class="material-icons">close</i>
                Cancel
            </button>
            <button class="btn btn-primary" id="createChatConfirmBtn">
                <i class="material-icons">add</i>
                Create Chat
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}
